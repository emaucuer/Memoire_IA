group_by(cod_commune, date_debut, date_fin, num_risque_jo) %>%
mutate(dup = n()) %>%
ungroup()
table(gaspar$dup)
gaspar <- gaspar %>%
arrange(cod_commune, date_debut, date_fin, desc(dat_pub_arrete)) %>%
distinct(cod_commune, date_debut, date_fin, num_risque_jo, .keep_all = T)
### Date de debut --------------------------------------------------------------
gaspar <- gaspar %>%
select(-dup) %>%
group_by(cod_commune, date_debut, num_risque_jo) %>%
mutate(dup = n()) %>%
ungroup()
table(gaspar$dup)
gaspar <- gaspar %>%
arrange(cod_commune, date_debut, desc(dat_pub_arrete), desc(date_fin)) %>%
distinct(cod_commune, date_debut, num_risque_jo, .keep_all = T)
### Date de fin ----------------------------------------------------------------
gaspar <- gaspar %>%
select(-dup) %>%
group_by(cod_commune, date_fin, num_risque_jo) %>%
mutate(dup = n()) %>%
ungroup()
table(gaspar$dup)
gaspar <- gaspar %>%
arrange(cod_commune, date_fin, desc(dat_pub_arrete), date_debut) %>%
distinct(cod_commune, date_fin, num_risque_jo, .keep_all = T) %>%
select(-dup)
# ---------------------------------------------------------------------------- #
# 5) Gestion des evenements pluri-annuels --------------------------------------
# ---------------------------------------------------------------------------- #
an_min = min(gaspar$an_debut)
an_max = max(gaspar$an_fin)
gaspar_pl <- gaspar
for (an in (an_min:(an_max+1))){
varname = paste0("y",an)
gaspar_pl[[varname]] <- with(gaspar_pl, an >= an_debut & an <= an_fin)
}
gaspar_pl <- gaspar_pl %>%
pivot_longer(paste0("y", an_min:an_max), names_to="annee") %>%
filter(value==T) %>%
select(-value) %>%
mutate(annee = substr(annee,2, 5))
gaspar_agregation_annuelle <- merge(gaspar, gaspar_pl,
by = c(cod_commune, annee), all = T)
gaspar_agregation_annuelle <- merge(gaspar_an, gaspar_an_pl,
by = c(cod_commune, annee), all = T)
gaspar_an <- gaspar %>%
group_by(cod_commune, an_debut) %>%
summarise(inondation = sum(inondation),
secheresse = sum(secheresse))
gaspar_an_pl <- gaspar_pl %>%
group_by(cod_commune, annee) %>%
mutate(annee = as.integer(annee)) %>%
summarise(inondation_pl = sum(inondation),
secheresse_pl = sum(secheresse))
gaspar_agregation_annuelle <- merge(gaspar_an, gaspar_an_pl,
by = c(cod_commune, annee), all = T)
gaspar_agregation_annuelle <- merge(gaspar_an, gaspar_an_pl,
by = c("cod_commune", "annee"), all = T)
gaspar_an <- gaspar %>%
group_by(cod_commune, annee) %>%
summarise(inondation = sum(inondation),
secheresse = sum(secheresse))
gaspar_an <- gaspar %>%
group_by(cod_commune, an_debut) %>%
summarise(inondation = sum(inondation),
secheresse = sum(secheresse))
gaspar_an <- gaspar %>%
group_by(cod_commune, an_debut) %>%
summarise(inondation = sum(inondation),
secheresse = sum(secheresse)) %>%
rename(annee = an_debut)
gaspar_an_pl <- gaspar_pl %>%
group_by(cod_commune, annee) %>%
mutate(annee = as.integer(annee)) %>%
summarise(inondation_pl = sum(inondation),
secheresse_pl = sum(secheresse))
gaspar_agregation_annuelle <- merge(gaspar_an, gaspar_an_pl,
by = c("cod_commune", "annee"), all = T)
write_rds(gaspar_agregation_annuelle, "../../Data/Gaspar/gaspar_ag.rds")
library(utils)
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
test <- unzip(zipfile = "../../Data/sswi/SWI_Package_1969-2021/", list = TRUE)
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
test <- unzip(zipfile = "../../Data/sswi/SWI_Package_1969-2021", list = TRUE)
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
test <- unzip(zipfile = "../../Data/sswi/SWI_Package_1969-2021.zip", list = TRUE)
test <- startsWith(test,"swi")
test <- test[startsWith(test,"swi")]
test2 <- grep("swi", test, value = TRUE)
View(test)
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
test <- unzip(zipfile = "../../Data/sswi/SWI_Package_1969-2021.zip", list = TRUE)[1]
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
test <- c(unzip(zipfile = "../../Data/sswi/SWI_Package_1969-2021.zip", list = TRUE)[1])
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
test <- unzip(zipfile = "../../Data/sswi/SWI_Package_1969-2021.zip", list = TRUE)$Name
test2 <- grep("swi", test, value = TRUE)
all_swi_files <- list.files("../../Data/sswi/SWI_Package_1969-2021/", "swi", all.files = T, full.names=T)
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
dossier_zip <- "../../Data/sswi/SWI_Package_1969-2021.zip"
# ---------------------------------------------------------------------------- #
# 1) Import & prepare data -----------------------------------------------------
# ---------------------------------------------------------------------------- #
dossier_zip <- "../../Data/sswi/SWI_Package_1969-2021.zip"
all_swi_files <- grep("swi",
unzip(zipfile = dossier_zip, list = TRUE)$Name,
value = TRUE)
all_swi_files_test <- grep("swi",
unzip(zipfile = dossier_zip, list = TRUE)$Name,
value = TRUE)
all_swi_files <- list.files("../../Data/sswi/SWI_Package_1969-2021/", "swi", all.files = T, full.names=T)
all_swi<- data.table()
library(data.table)
all_swi<- data.table()
for (file in all_swi_files_test[1:2]){
current_swi <- read_csv2(unz(dossier_zip, file))
setDT(current_swi)
all_swi <- rbind(all_swi, current_swi)
}
library(readr)
for (file in all_swi_files_test[1:2]){
current_swi <- read_csv2(unz(dossier_zip, file))
setDT(current_swi)
all_swi <- rbind(all_swi, current_swi)
}
all_swi2<- data.table()
for (file in all_swi_files[1:2]){
current_swi <- read_csv2(unz(dossier_zip, file))
setDT(current_swi)
all_swi2 <- rbind(all_swi2, current_swi)
}
current_swi <- read_csv2(file)
for (file in all_swi_files[1:2]){
current_swi <- read_csv2(file)
setDT(current_swi)
all_swi2 <- rbind(all_swi2, current_swi)
}
all_swi == all_swi2
table(all_swi == all_swi2)
# Libraries
library(readr)
library(dplyr)
library(readxl)
library(stringi)
library(lubridate)
library(tidyr)
library(data.table)
library(stats)
gaspar <- read_rds("../../Data/Gaspar/gaspar.rds")
code_catnat <- read_csv2("../../Data/Gaspar/code_jo_catnat.csv")
coord_com <- read_rds("../../Data/Administratif/coordCom2018.rds") %>%
filter(code < 96000) %>% arrange(code)
# gestion des donnees gaspar
gaspar <- gaspar %>%
merge(code_catnat %>% select(Nom, nom_simple, Code), by.x = "num_risque_jo", by.y = "Code")
gaspar_ag_fin <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "nom_simple",value = "nb_cat_nat")
gaspar_ag_gros <- gaspar %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
# Base avec toutes les communes pour toutes les annees
cod_commune <- rep(coord_com$code, length(1982:2021))
annee <- sort(rep(1982:2021,length(coord_com$code)))
data_com_an <- data.table(annee, cod_commune)
# Bases finales
catnat_com_1982_2021_details <- merge(data_com_an, gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T)
catnat_com_1982_2021_ag <- merge(data_com_an, gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T)
# Bases finales
catnat_com_1982_2021_details <- merge(data_com_an, gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0)
catnat_com_1982_2021_ag <- merge(data_com_an, gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_com_1982_2021_ag <- data_com_an %>%
merge(gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
View(catnat_com_1982_2021_ag)
# Libraries
library(readr)
library(dplyr)
library(readxl)
library(stringi)
library(lubridate)
library(tidyr)
library(data.table)
library(stats)
gaspar <- read_rds("../../Data/Gaspar/gaspar.rds")
code_catnat <- read_csv2("../../Data/Gaspar/code_jo_catnat.csv")
coord_com <- read_rds("../../Data/Administratif/coordCom2018.rds") %>%
filter(code < 96000) %>% arrange(code)
# gestion des donnees gaspar
gaspar <- gaspar %>%
merge(code_catnat %>% select(Nom, nom_simple, Code), by.x = "num_risque_jo", by.y = "Code")
gaspar_ag_fin <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "nom_simple",value = "nb_cat_nat")
gaspar_ag_gros <- gaspar %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
# Base avec toutes les communes pour toutes les annees
cod_commune <- rep(coord_com$code, length(1982:2021))
annee <- sort(rep(1982:2021,length(coord_com$code)))
data_com_an <- data.table(annee, cod_commune)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_com_1982_2021_ag <- data_com_an %>%
merge(gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
View(code_catnat)
code_catnat <- read_csv2("../../Data/Gaspar/code_jo_catnat.csv")
# gestion des donnees gaspar
gaspar <- gaspar %>%
merge(code_catnat %>% select(Nom, nom_simple, Code), by.x = "num_risque_jo", by.y = "Code")
gaspar_ag_fin <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "nom_simple",value = "nb_cat_nat")
gaspar_ag_gros <- gaspar %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
# Base avec toutes les communes pour toutes les annees
cod_commune <- rep(coord_com$code, length(1982:2021))
annee <- sort(rep(1982:2021,length(coord_com$code)))
data_com_an <- data.table(annee, cod_commune)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_com_1982_2021_ag <- data_com_an %>%
merge(gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
gaspar <- read_rds("../../Data/Gaspar/gaspar.rds")
code_catnat <- read_csv2("../../Data/Gaspar/code_jo_catnat.csv")
coord_com <- read_rds("../../Data/Administratif/coordCom2018.rds") %>%
filter(code < 96000) %>% arrange(code)
# gestion des donnees gaspar
gaspar <- gaspar %>%
merge(code_catnat %>% select(Nom, nom_simple, Code), by.x = "num_risque_jo", by.y = "Code")
gaspar_ag_fin <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "nom_simple",value = "nb_cat_nat")
gaspar_ag_gros <- gaspar %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
View(gaspar_ag_gros)
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = tolower(lib_risque_jo2)) %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
# Base avec toutes les communes pour toutes les annees
cod_commune <- rep(coord_com$code, length(1982:2021))
annee <- sort(rep(1982:2021,length(coord_com$code)))
data_com_an <- data.table(annee, cod_commune)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_com_1982_2021_ag <- data_com_an %>%
merge(gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
gaspar_test <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n())
table(gaspar_test$an_debut, gaspar_test$nom_simple)
table(gaspar_test$nom_simple, gaspar_test$an_debut)
View(gaspar)
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII") %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n())
)
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII")) %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n())
View(gaspar_ag_gros)
table(gaspar_ag_gros$lib_risque_jo2)
mutate(lib_risque_jo2 = str_replace(stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII"), " ", "_") %>%
)
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = str_replace(stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII"), " ", "_")) %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n())
library(stringi)
library(tidyr)
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = str_replace(stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII"), " ", "_")) %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n())
library(tidyverse)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_com_1982_2021_ag <- data_com_an %>%
merge(gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
# Libraries
library(readr)
library(dplyr)
library(readxl)
library(stringi)
library(lubridate)
library(tidyr)
library(data.table)
library(stats)
library(tidyverse)
gaspar <- read_rds("../../Data/Gaspar/gaspar.rds")
code_catnat <- read_csv2("../../Data/Gaspar/code_jo_catnat.csv")
coord_com <- read_rds("../../Data/Administratif/coordCom2018.rds") %>%
filter(code < 96000) %>% arrange(code)
# gestion des donnees gaspar
gaspar <- gaspar %>%
merge(code_catnat %>% select(Nom, nom_simple, Code), by.x = "num_risque_jo", by.y = "Code")
gaspar_test <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n())
gaspar_ag_fin <- gaspar %>%
group_by(an_debut,cod_commune, nom_simple) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "nom_simple",value = "nb_cat_nat")
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = str_replace(stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII"), " ", "_")) %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
View(gaspar_ag_fin)
gaspar_ag_gros <- gaspar %>%
mutate(lib_risque_jo2 = str_replace(stri_trans_general(tolower(lib_risque_jo2),"Latin-ASCII"), " ", "_")) %>%
group_by(an_debut,cod_commune, lib_risque_jo2) %>%
summarise(nb_cat_nat = n()) %>%
spread(key = "lib_risque_jo2",value = "nb_cat_nat")
View(gaspar_ag_gros)
# Base avec toutes les communes pour toutes les annees
cod_commune <- rep(coord_com$code, length(1982:2021))
annee <- sort(rep(1982:2021,length(coord_com$code)))
data_com_an <- data.table(annee, cod_commune)
# Bases finales
catnat_com_1982_2021_details <- data_com_an %>%
merge(gaspar_ag_fin, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_com_1982_2021_ag <- data_com_an %>%
merge(gaspar_ag_gros, by.x = c("annee","cod_commune"),
by.y = c("an_debut", "cod_commune"), all = T) %>%
replace(is.na(.), 0) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
View(catnat_com_1982_2021_details)
View(catnat_com_1982_2021_ag)
catnat_an_peril <- table(gaspar_test$an_debut, gaspar_test$nom_simple)
catnat_an_peril <- as.data.table(table(gaspar_test$an_debut, gaspar_test$nom_simple))
View(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple))
View(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple),
col.names = c("annee", "peril", "freq"))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple),
col.names = c("an_debut", "nom_simple", "nb"))%>%
spread(key = "nom_simple",value = "nb")
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple),
col.names = c("an_debut", "nom_simple", "nb"))
View(catnat_an_peril)
catnat_an_peril <- as.data.table(table(gaspar_test$an_debut, gaspar_test$nom_simple),
col.names = c("annee", "nom_simple", "nb")) %>%
spread(key = "nom_simple",value = "nb")
catnat_an_peril <- as.data.table(table(gaspar_test$an_debut, gaspar_test$nom_simple),
col.names = c("annee", "nom_simple", "nb"))
View(catnat_an_peril)
catnat_an_peril <- as.data.table(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
spread(key = "V2",value = "freq")
catnat_an_peril <- as.data.table(table(gaspar_test$an_debut, gaspar_test$nom_simple))
View(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
spread(key = "V2",value = "N")
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple))
View(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
spread(key = "Var2",value = "Freq")
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
spread(key = "Var2",value = "Freq") %>%
rename(Var1=annee)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1")
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq), Var1 = as.integer(Var1)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq), Var1 = as.integer(Var1))
View(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1")
View(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(annee = as.integer(annee))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1")
typeof(catnat_an_peril$annee)
typeof(catnat_an_peril)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple))
typeof(catnat_an_peril)
typeof(gaspar_test)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1")
table(catnat_an_peril$annee < 1988)
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(annee = as.character(annee))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(annee = as.integer(as.character(annee)))
catnat_an_peril <- as.data.frame(table(gaspar_test$an_debut, gaspar_test$nom_simple)) %>%
mutate(Freq = as.integer(Freq)) %>%
spread(key = "Var2",value = "Freq") %>%
rename("annee"="Var1") %>%
mutate(annee = as.integer(as.character(annee))) %>%
mutate(secheresse = ifelse(annee < 1988, NA, secheresse))
# Enregistrement
write_csv2(catnat_an_peril, "../../Data/Gaspar/catnat_an_peril.csv")
write_csv2(catnat_com_1982_2021_details, "../../Data/Gaspar/catnat_com_1982_2021_details.csv")
write_csv2(catnat_com_1982_2021_ag, "../../Data/Gaspar/catnat_com_1982_2021_ag.csv")
